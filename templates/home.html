<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TransformoDocs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<style>
    /* Sidebar styles */
    .sidebar {
        position: fixed;
        top: 0;
        left: -250px; /* Hidden initially */
        width: 250px;
        height: 100%;
        background-color: #343a40;
        color: white;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
        overflow-y: auto;
        transition: left 0.3s ease;
        z-index: 1050; /* Above everything */
    }

    .sidebar.active {
        left: 0; /* Visible when active */
    }

    .sidebar .close-btn {
        font-size: 24px;
        color: white;
        position: absolute;
        top: 10px;
        right: 15px;
        cursor: pointer;
    }

    .sidebar .nav-item a {
        color: white;
        text-decoration: none;
        padding: 10px 15px;
        display: block;
    }

    .sidebar .nav-item a:hover {
        background-color: #495057;
        text-decoration: none;
    }

    /* Hamburger menu styles */
    .hamburger {
        position: fixed;
        top: 10px;
        left: 10px;
        font-size: 28px;
        cursor: pointer;
        color: #333;
        z-index: 1100; /* Above the sidebar */
        transition: transform 0.3s ease;
    }


    /* Body overlay when sidebar is open */
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1049; /* Below sidebar but above the rest */
        display: none;
    }

    .overlay.active {
        display: block;
    }
    .nav-item{
        padding-top:30px;
    }


    
</style>
<body>
    <div class="hamburger">
        <i class="fas fa-bars"></i>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
        <span class="close-btn">&times;</span>
        <nav class="nav flex-column">
            <div class="nav-item">
                <a href="{{ url_for('index') }}">Home</a>
            </div>
            <div class="nav-item">
                <a href="#features">Features</a>
            </div>
            <div class="nav-item">
                <a href="#about">About Us</a>
            </div>
            <div class="nav-item">
                <a href="#contact">Contact</a>
            </div>
        </nav>
    </div>

    <!-- Body Overlay -->
    <div class="overlay"></div>
    
   
    <div class="container mt-5">
            <div class="logo-container">
                <svg class="logo" viewBox="0 0 300 80" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle cx="50" cy="40" r="30" fill="url(#logoGradient)" class="logo-circle" />
                    <path d="M35,40 L45,30 L55,40 L65,30" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="logo-lines" />
                    <path d="M35,50 L45,40 L55,50 L65,40" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="logo-lines" />

                    <text x="95" y="32" font-family="Poppins, sans-serif" font-size="24" font-weight="700" fill="#333" class="logo-text">Transformo</text>
                    <text x="95" y="58" font-family="Poppins, sans-serif" font-size="24" font-weight="700" fill="#4CAF50" class="logo-text">Docs</text>
                </svg>
            </div>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('index') }}">Home</a></li>
                    {% for folder in current_path.split('/') %}
                    {% if folder %}
                    <li class="breadcrumb-item"><a href="{{ url_for('index', path='/'.join(current_path.split('/')[:loop.index])) }}">{{ folder }}</a></li>
                    {% endif %}
                    {% endfor %}
                </ol>
            </nav>
            <div id="search-container">
                <div class="mb-3">
                    <div class="input-group">
                        <input type="text" id="search" class="form-control" placeholder="Search files...">
                        <select id="search-type" class="form-select">
                            <option value="name">Search by Name</option>
                            <option value="content">Search by Content</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <button id="create-folder-btn" class="btn btn-primary"><i class="fas fa-folder-plus"></i> Create Folder</button>
                <button id="upload-btn" class="btn btn-success"><i class="fas fa-upload"></i> Upload File</button>
                <button id="download-btn" class="btn btn-info" disabled><i class="fas fa-download"></i> Download</button>
                <button id="download-converted-btn" class="btn btn-secondary" disabled><i class="fas fa-file-alt"></i> Download Converted</button>
                <button id="delete-btn" class="btn btn-danger" disabled><i class="fas fa-trash"></i> Delete</button>
                <button id="copy-btn" class="btn btn-secondary" disabled><i class="fas fa-copy"></i> Copy</button>
                <button id="cut-btn" class="btn btn-warning" disabled><i class="fas fa-cut"></i> Cut</button>
                <button id="paste-btn" class="btn btn-light" disabled><i class="fas fa-paste"></i> Paste</button>
                <button id="view-btn" class="btn btn-info" disabled><i class="fas fa-eye"></i> View</button>
            </div>

            <form id="upload-form" class="mb-3" style="display: none;">
                <div class="input-group">
                    <input type="file" class="form-control" id="file-input" name="file" multiple>
                    <button class="btn btn-primary" type="submit">Upload</button>
                </div>
            </form>

            <ul id="file-list" class="list-group"> <!-- Uploaded files will be dynamically added here --> </ul>
            </ul>
            
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script>
               
            $(document).ready(function () {
                const sidebar = $('.sidebar');
                const overlay = $('.overlay');
                const hamburger = $('.hamburger');
                const closeBtn = $('.close-btn');
    
                // Open sidebar
                hamburger.on('click', function () {
                    sidebar.addClass('active');
                    overlay.addClass('active');
                });
    
                // Close sidebar
                closeBtn.on('click', function () {
                    sidebar.removeClass('active');
                    overlay.removeClass('active');
                });
    
                // Close sidebar when clicking on the overlay
                overlay.on('click', function () {
                    sidebar.removeClass('active');
                    overlay.removeClass('active');
                });
            });
          

            $(document).ready(function () {
                var currentPath = '{{ current_path }}';

                function updateButtonStates() {
                    var checkedItems = $('input[type="checkbox"]:checked');
                    var checkedFiles = checkedItems.filter('[data-type="file"]');
                    $('#download-btn, #delete-btn, #copy-btn, #cut-btn, #view-btn').prop('disabled', checkedItems.length === 0);
                    $('#download-converted-btn').prop('disabled', checkedFiles.length === 0);
                    $('#paste-btn').prop('disabled', !localStorage.getItem('clipboard'));
                }



                function updateBreadcrumb(path) {
                    var parts = path.split('/').filter(Boolean);
                    var $breadcrumb = $('.breadcrumb');
                    $breadcrumb.empty();
                    $breadcrumb.append('<li class="breadcrumb-item"><a href="#" data-path="">Home</a></li>');
                    var currentPath = '';
                    parts.forEach(function (part) {
                        if (part) {
                            currentPath += part + '/';
                            $breadcrumb.append(`<li class="breadcrumb-item"><a href="#" data-path="${currentPath}">${part}</a></li>`);
                        }
                    });
                }
                $(document).on('click', '.folder-link', function (e) {
                    e.preventDefault();
                    var path = $(this).data('path');
                    refreshFileList(path);
                });

                $(document).on('click', '.breadcrumb-item a', function (e) {
                    e.preventDefault();
                    var path = $(this).data('path');
                    refreshFileList(path);
                });

                function createListItem(item, isFolder) {
                    var icon = isFolder ? 'fa-folder' : 'fa-file';
                    var dataType = isFolder ? 'folder' : 'file';
                    var itemName = item.split('/').pop();
                    var fullPath = currentPath ? currentPath + '/' + itemName : itemName;

                    return `
            <li class="list-group-item">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" data-name="${item.name}" data-type="${item.type}">
                    <label class="form-check-label">
                        <i class="fas ${icon} me-2"></i>
                        ${item.type === 'folder' ?
                            `<a href="#" class="folder-link" data-path="${fullPath}">${item.name}</a>` :
                            item.name}
                    </label>
                </div>
            </li>
        `;
                }

                $('body').on('change', 'input[type="checkbox"]', updateButtonStates);

                $('body').on('click', '.folder-link', function (e) {
                    e.preventDefault();
                    var path = $(this).data('path');
                    refreshFileList(path);
                });

                $('body').on('click', '.breadcrumb-item a', function (e) {
                    e.preventDefault();
                    var path = $(this).data('path');
                    refreshFileList(path);
                });

                $('#create-folder-btn').click(function () {
                    var folderName = prompt("Enter folder name:");
                    if (folderName) {
                        $.ajax({
                            url: '/create_folder',
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                folder_name: folderName,
                                parent_path: currentPath
                            }),
                            success: function (response) {
                                alert(response.message);
                                refreshFileList(currentPath);
                            },
                            error: function (xhr) {
                                alert('Error creating folder: ' + xhr.responseJSON.error);
                            }
                        });
                    }
                });

                $('#upload-btn').click(function () {
                    $('#upload-form').toggle();
                });

                $('#upload-form').submit(function (e) {
                    e.preventDefault();
                    var formData = new FormData(this);
                    formData.append('parent_path', currentPath);
                    $.ajax({
                        url: '/upload',
                        type: 'POST',
                        data: formData,
                        contentType: false,
                        processData: false,
                        success: function (response) {
                            alert(response.message);
                            refreshFileList(currentPath);
                        },
                        error: function (xhr) {
                            alert('Error uploading file(s): ' + (xhr.responseJSON ? xhr.responseJSON.error : 'Unknown error'));
                        }
                    });
                });

                function refreshFileList(path) {
                    $.ajax({
                        url: '/list_files',
                        type: 'GET',
                        data: { path: path },
                        success: function (data) {
                            $('#file-list').html(data);
                            currentPath = path;
                            updateBreadcrumb(path);
                            updateButtonStates();
                            bindFolderLinkEvents();
                        },
                        error: function (xhr) {
                            alert('Error refreshing file list: ' + (xhr.responseJSON ? xhr.responseJSON.error : 'Unknown error'));
                        }
                    });
                }

                $('#download-btn').click(function () {
                    $('input[type="checkbox"]:checked').each(function () {
                        var item = $(this).data('name');
                        window.open('/download/' + currentPath + '/' + item, '_blank');
                    });
                });

                $('#download-converted-btn').click(function () {
                    $('input[type="checkbox"][data-type="file"]:checked').each(function () {
                        var item = $(this).data('name');
                        window.open('/download_converted/' + currentPath + '/' + item, '_blank');
                    });
                });

                $('#delete-btn').click(function () {
                    if (confirm('Are you sure you want to delete the selected item(s)?')) {
                        var items = $('input[type="checkbox"]:checked').map(function () {
                            return $(this).data('name');
                        }).get();
                        $.ajax({
                            url: '/delete',
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                items: items,
                                parent_path: currentPath
                            }),
                            success: function (response) {
                                alert(response.message);
                                refreshFileList(currentPath);
                            },
                            error: function (xhr) {
                                alert('Error deleting item(s): ' + xhr.responseJSON.error);
                            }
                        });
                    }
                });

                $('#copy-btn, #cut-btn').click(function () {
                    var action = $(this).attr('id').split('-')[0];
                    var items = $('input[type="checkbox"]:checked').map(function () {
                        return {
                            name: $(this).data('name'),
                            type: $(this).data('type')
                        };
                    }).get();
                    localStorage.setItem('clipboard', JSON.stringify({
                        action: action,
                        items: items,
                        sourcePath: currentPath
                    }));
                    updateButtonStates();
                });

                $('#paste-btn').click(function () {
                    var clipboard = JSON.parse(localStorage.getItem('clipboard'));
                    if (clipboard) {
                        $.ajax({
                            url: '/paste',
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify({
                                clipboard: clipboard,
                                destination_path: currentPath
                            }),
                            success: function (response) {
                                alert(response.message);
                                localStorage.removeItem('clipboard');
                                refreshFileList(currentPath);
                            },
                            error: function (xhr) {
                                alert('Error pasting item(s): ' + xhr.responseJSON.error);
                            }
                        });
                    }
                });
                
                function performSearch() {
                    var query = $('#search').val().toLowerCase();
                    var searchType = $('#search-type').val();

                    if (query.trim() === '') {
                        refreshFileList(currentPath);
                        return;
                    }

                    $.ajax({
                        url: '/search',
                        type: 'GET',
                        data: {
                            query: query,
                            type: searchType,
                            current_path: currentPath
                        },
                        success: function (results) {
                            $('#file-list').empty();
                            results.forEach(function (item) {
                                var icon = item.type === 'folder' ? 'fa-folder' : 'fa-file';
                                var listItem = `
                        <li class="list-group-item">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" data-name="${item.name}" data-type="${item.type}">
                                <label class="form-check-label">
                                    <i class="fas ${icon} me-2"></i>
                                    ${item.type === 'folder' ?
                                        `<a href="#" class="folder-link" data-path="${item.path}">${item.name}</a>` :
                                        item.name}
                                </label>
                            </div>
                        </li>
                    `;
                                $('#file-list').append(listItem);
                            });
                            updateButtonStates();
                        },
                        error: function (xhr, status, error) {
                            console.error("Search error:", error);
                            alert("An error occurred while searching. Please try again.");
                        }
                    });
                }



                $('#search').on('input', function () {
                    performSearch();
                });

                $('#search-type').on('change', performSearch);

                $(document).on('click', function (event) {
                    var searchContainer = $('#search-container');
                    var fileList = $('#file-list');

                    if (!searchContainer.is(event.target) && searchContainer.has(event.target).length === 0 &&
                        !fileList.is(event.target) && fileList.has(event.target).length === 0) {
                        resetSearch();
                    }
                });

                $('#search-container, #file-list').on('click', function (event) {
                    event.stopPropagation();
                });

                $('#file-list').on('change', 'input[type="checkbox"]', function () {
                    updateButtonStates();
                });


                function bindFolderLinkEvents() {
                    // Unbind any existing folder link event handlers
                    $('#file-list').off('click', '.folder-link');

                    // Bind new folder link event handlers
                    $('#file-list').on('click', '.folder-link', function (e) {
                        e.preventDefault();
                        var path = $(this).data('path');
                        refreshFileList(path);
                    });
                }
                function resetSearch() {
                    $('#search').val('');
                    refreshFileList(currentPath);
                }
                // Initialize
                refreshFileList('');
            });

        </script>
</body>
</html>
